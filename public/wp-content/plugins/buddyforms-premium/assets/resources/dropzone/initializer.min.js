;function uploadHandler(){var e,t,i="";function d(e){t=jQuery.map(e,function(e){return(jQuery(e).attr("type")==="submit"&&jQuery(e).hasClass("bf-submit"))?jQuery(e):null})[0];i=t.html()};function n(){jQuery(".upload_field").each(function(){var e=jQuery(this),t=(e.attr("page")!=="buddyforms_submissions"),a=e.attr("file_limit"),i=e.attr("accepted_files"),o=e.attr("multiple_files"),l=e.data("entry"),r=e.attr("form-slug");jQuery("#buddyforms_form_"+r).show();u(e,e.attr("id"),a,i,o,t,l)})};function u(e,t,i,n,u,r,a){var d=jQuery(e).find("input[type=\"text\"][style*=\"hidden\"]"),b="#"+t;if(buddyformsGlobal){var m={url:buddyformsGlobal.admin_url,maxFilesize:i,parallelUploads:1,acceptedFiles:n,maxFiles:u,clickable:r,addRemoveLinks:r,init:function(){this.on("queuecomplete",function(){e.removeClass("error")});this.on("addedfile",function(){s(b)});this.on("success",function(e,t){c(e,t,d)});this.on("error",f);this.on("sending",l);this.on("sendingmultiple",l);this.on("complete",o);this.on("completemultiple",o);this.on("removedfile",function(e){p(e,d)});if(a){for(var i in a){if(i){var t={name:a[i]["name"],size:a[i]["size"],url:a[i]["url"],attachment_id:a[i]["attachment_id"],};this.emit("addedfile",t);this.emit("thumbnail",t,t.url);this.emit("complete",t);this.files.push(t)}}}},dictMaxFilesExceeded:buddyformsGlobal.localize.upload.dictMaxFilesExceeded||"You can not upload any more files.",dictRemoveFile:buddyformsGlobal.localize.upload.dictRemoveFile||"Remove file",dictCancelUploadConfirmation:buddyformsGlobal.localize.upload.dictCancelUploadConfirmation||"Are you sure you want to cancel this upload?",dictCancelUpload:buddyformsGlobal.localize.upload.dictCancelUpload||"Cancel upload",dictResponseError:buddyformsGlobal.localize.upload.dictResponseError||"Server responded with {{statusCode}} code.",dictInvalidFileType:buddyformsGlobal.localize.upload.dictInvalidFileType||"You can't upload files of this type.",dictFileTooBig:buddyformsGlobal.localize.upload.dictFileTooBig||"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictFallbackMessage:buddyformsGlobal.localize.upload.dictFallbackMessage||"Your browser does not support drag'n'drop file uploads.",dictDefaultMessage:buddyformsGlobal.localize.upload.dictDefaultMessage||"Drop files here to upload",};jQuery(e).dropzone(m)}};function o(){a()};function s(e){jQuery(e).find("label[class*='error']").text("");jQuery(e).find(".dz-progress").hide()};function l(e,t,a){r(!0);a.append("action","handle_dropped_media");a.append("nonce",buddyformsGlobal.ajaxnonce)};function c(e,t,a){e.previewElement.classList.add("dz-success");e["attachment_id"]=t;var i=jQuery(a).val()+","+t,o="";if(i[0]===","){o=i.substring(1,i.length)}
else{o=i};jQuery(a).attr("value",o)};function f(e,t){e.previewElement.classList.add("dz-error");jQuery(e.previewElement).find("div.dz-error-message>span").text(t);a()};function p(e,a){var i=e.attachment_id,o=jQuery(a).val(),t=o.replace(i,"");if(t[0]===","){t=t.substring(1,o.length)};var l=t[t.length-1];if(l===","){t=t.slice(0,-1)};jQuery(a).attr("value",t);m(i)};function m(e){r(!1);jQuery.post(buddyformsGlobal.admin_url,{action:"handle_deleted_media",media_id:e,nonce:buddyformsGlobal.ajaxnonce},function(e){console.log(e)}).always(function(){a()})};function r(a){if(buddyformsGlobal){if(e.length>0){a=!!(a);e.attr("disabled","disabled");if(a){t.html(buddyformsGlobal.localize.upload.submitButton||"Upload in progress")}}}};function b(){var e=!0;jQuery(".upload_field").each(function(){var t=jQuery(this)[0].dropzone;if(t&&t.files.length>0){var a=t.files.filter(function(e){return e.status===Dropzone.UPLOADING});e=a.length===0}});return e};function a(){if(e.length>0&&b()){e.removeAttr("disabled");t.html(i)}};return{init:function(){var t=jQuery(".upload_field");e=jQuery("div.form-actions button.bf-submit[type=submit], div.form-actions button.bf-draft[type=submit]");if(e.length>0){d(e)};if(t.length>0){n()}}}};function validateAndUploadImage(e){var o=jQuery(e),t=o.attr("field-id");jQuery("#"+t+"_label").text("");jQuery("#"+t+"_image").attr("src","");jQuery("#field_"+t).val("");var i=jQuery("#"+t+"_upload_from_url").val();if(checkURL(i)){jQuery("#"+t+"_upload_button").text("Uploading..");jQuery("#"+t+"_upload_button").attr("disabled",!0);var a=jQuery("div.form-actions button.bf-submit[type=submit], div.form-actions button.bf-draft[type=button]");a.attr("disabled",!0);jQuery.ajax({url:buddyformsGlobal.admin_url,type:"post",data:{action:"upload_image_from_url",url:encodeURIComponent(i),id:t},success:function(e){var i=JSON.parse(e);if(i.status==="OK"){jQuery("#"+t+"_image").attr("src",i.response);jQuery("#"+t+"_image").attr("width",300);jQuery("#"+t+"_image").attr("height",300);jQuery("#field_"+t).val(i.attachment_id);jQuery("#"+t+"_upload_button").text("Upload");jQuery("#"+t+"_upload_button").attr("disabled",!1);a.attr("disabled",!1)}
else{if(i.status==="FAILED"){jQuery("#"+t+"_label").text(i.response);jQuery("#"+t+"_upload_button").text("Upload");jQuery("#"+t+"_upload_button").attr("disabled",!1);a.attr("disabled",!1)}}},error:function(e){var t=JSON.parse(e)}})}
else{jQuery("#"+t+"_label").text("Wrong Url Format")}};function checkURL(e){return(e.match(/\.(jpeg|jpg|gif|png)$/)!=null)};var uploadImplementation=uploadHandler();jQuery(document).ready(function(){uploadImplementation.init()});if(Dropzone){Dropzone.autoDiscover=!1};